---
- name: Setup passwordless sudo
  tags: initial-setup
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    regexp: ^%sudo
    line: "%sudo ALL=(ALL) NOPASSWD: ALL"
    validate: visudo -cf %s

- name: Create "ansible" user
  tags: initial-setup
  ansible.builtin.user:
    name: ansible
    groups: sudo
    append: true

- name: Set authorized key for "ansible" user
  tags: initial-setup
  ansible.posix.authorized_key:
    user: ansible
    key: "{{ lookup('file', 'files/ssh/id_ansible.pub') }}"

- name: Create "aki" group
  ansible.builtin.group:
    name: aki

- name: Create "aki" user
  ansible.builtin.user:
    name: aki
    group: aki
    groups: sudo
    append: true
    password: $6$wGLv4RPOB2GHWk3I$7DLQ6VxTcQXQIvO.hDSvcQwsjMIt5fSGWcsxJYrtfUCXix1Gmp69IXBJ8cPg4RwJaOG6N8kVOj2Q.e4RNDv7.1

- name: Update apt package cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600

